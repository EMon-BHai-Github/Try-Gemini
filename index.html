<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Emon AI â€“ All-in-One</title>
  <style>
    body { background:#0d1117; color:#c9d1d9; font-family:sans-serif; padding:20px; }
    header { text-align:center; margin-bottom:20px; }
    select, input, textarea, button {
      width:100%; margin:8px 0; padding:10px; border-radius:6px; border:none;
      font-size:16px;
    }
    input[type="password"] { background-color:#161b22; color:#8b949e; }
    button {
      background:#238636; color:white; font-weight:bold; cursor:pointer;
      transition: background 0.2s;
    }
    button:hover { background:#2ea043; }
    img, video { max-width:100%; margin-top:12px; border-radius:10px; }
    #output { margin-top:20px; padding:15px; background:#161b22; border-radius:10px; }
  </style>
</head>
<body>
  <header><h1>Emon AI â€” Text | Image | Video | Edit</h1></header>
  <input id="apiKey" type="password" value="AIzaSyDfj1K8t3p9ObXnz1wxjVFSvm3nxDSz8W8" readonly />
  <select id="mode">
    <option value="text">ğŸ“ Text Chat</option>
    <option value="image">ğŸ–¼ï¸ Generate Image</option>
    <option value="video">ğŸ¬ Generate Video</option>
    <option value="edit">ğŸ–Œï¸ Edit Uploaded Image</option>
  </select>
  <textarea id="prompt" placeholder="Enter your prompt..." rows="4"></textarea>
  <input id="imageInput" type="file" accept="image/*" style="display:none" />
  <button onclick="run()">Run</button>
  <div id="output"></div>

  <script>
    document.getElementById('mode').addEventListener('change', () => {
      const mode = document.getElementById('mode').value;
      document.getElementById('imageInput').style.display = mode === 'edit' ? 'block' : 'none';
    });

    async function run() {
      const key = document.getElementById("apiKey").value.trim();
      const mode = document.getElementById("mode").value;
      const prompt = document.getElementById("prompt").value.trim();
      const out = document.getElementById("output");
      const imgInput = document.getElementById("imageInput");

      if (!key || !prompt) return out.innerText = "â— Prompt is missing";
      out.innerHTML = "â³ Processing...";

      try {
        let url, payload, handler;

        if (mode === "text") {
          url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${key}`;
          payload = { contents: [{ parts: [{ text: prompt }] }] };
          handler = async r => {
            const j = await r.json();
            return j?.candidates?.[0]?.content?.parts?.[0]?.text || "âš ï¸ No response.";
          };

        } else if (mode === "image") {
          url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-pro-vision:generateContent?key=${key}`;
          payload = {
            contents: [{ parts: [{ text: prompt }] }],
            generationConfig: { responseMimeType: "image/png" }
          };
          handler = async r => {
            const j = await r.json();
            const b64 = j?.candidates?.[0]?.content?.parts?.find(p=>p.inlineData)?.inlineData?.data;
            return b64 ? `<img src="data:image/png;base64,${b64}" />` : "âš ï¸ No image generated.";
          };

        } else if (mode === "video") {
          url = `https://generativelanguage.googleapis.com/v1beta/models/veo-2.0-generate-001:generateVideos?key=${key}`;
          payload = {
            prompt,
            config: { personGeneration: "dont_allow", aspectRatio: "16:9" }
          };
          handler = async r => {
            const job = await r.json();
            const op = job?.name;
            if (!op) return "âš ï¸ Video job not started.";
            let final;
            do {
              await new Promise(res => setTimeout(res, 10000));
              const poll = await fetch(`https://generativelanguage.googleapis.com/v1beta/${op}?key=${key}`);
              final = await poll.json();
            } while (!final.done);
            const vid = final?.response?.generatedVideos?.[0]?.video;
            return vid ? `<video controls src="${vid}"></video>` : "âš ï¸ Failed to load video.";
          };

        } else if (mode === "edit") {
          const file = imgInput.files[0];
          if (!file) return out.innerText = "â— Please upload an image.";
          const b64 = await toBase64(file);
          url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-pro-vision:generateContent?key=${key}`;
          payload = {
            contents: [{
              parts: [
                { inlineData: { mimeType: "image/png", data: b64 } },
                { text: prompt }
              ]
            }]
          };
          handler = async r => {
            const j = await r.json();
            const parts = j?.candidates?.[0]?.content?.parts || [];
            const imagePart = parts.find(p => p.inlineData)?.inlineData?.data;
            const textPart = parts.find(p => p.text)?.text;

            if (imagePart) {
              return `<img src="data:image/png;base64,${imagePart}" />`;
            } else if (textPart) {
              return `<p>ğŸ“ AI Response: ${textPart}</p>`;
            } else {
              return "âš ï¸ Gemini didn't return any image or text.";
            }
          };
        }

        const res = await fetch(url, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload)
        });

        out.innerHTML = await handler(res);

      } catch (e) {
        out.innerHTML = "âŒ Error: " + e.message;
      }
    }

    function toBase64(file) {
      return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onload = () => resolve(reader.result.split(',')[1]);
        reader.onerror = error => reject(error);
        reader.readAsDataURL(file);
      });
    }
  </script>
</body>
</html>
